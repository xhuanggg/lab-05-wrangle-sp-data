---
title: "Lab 05 - La Quinta is Spanish for next to Denny's, Pt. 2"
author: "Thomas Huang"
date: "2026-02-06"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
library(ggridges)
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
data(dennys, package = "dsbox")
data(laquinta, package = "dsbox")
```

### Exercise 1

There are three Denny's and two La Quinta in Alaska.
```{r Ex1}
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)

lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(lq_ak)
```

### Exercise 2

There are three Denny's and two La Quinta in Alaska. Each Denny's corresponds to two La Quinta. Therefore, there should be $$3\times2=6$$ pairs.

### Exercise 3

```{r Ex3}
dn_lq_ak <- full_join(dn_ak, lq_ak,
  by = "state"
)
dn_lq_ak
```

### Exercise 4

There are six observations in this data frame. The variable are street address, city, state, zip code, longitude, and latitude of each Denny's and La Quinta.
```{r Ex4}
glimpse(dn_lq_ak)
```

### Exercise 5

dplyr::mutate(new_var = ...) can be used to create a new variable.
```{r Ex5}
# Define a cool function that calculates the distance between any two points on the earth.
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}
```

### Exercise 6

```{r Ex6}
dn_lq_ak <- dn_lq_ak %>% 
  dplyr::mutate(
    distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)
  )

glimpse(dn_lq_ak)
```

### Exercise 7

```{r Ex7}
dn_lq_ak <- dn_lq_ak %>% 
  group_by(address.x) %>% 
  mutate(min_distance = min(distance))
```

### Exercise 8

```{r Ex8}
# Summary stats
psych::describe(dn_lq_ak$min_distance)

ggplot(data = dn_lq_ak, aes(x = min_distance)) +
  geom_histogram()
```

### Exercise 9

```{r Ex9-Def-Function}
state_function <- function(state_abbr){
  dn_state <- dennys %>%
  filter(state == state_abbr)

  lq_state <- laquinta %>%
  filter(state == state_abbr)
  
  dn_lq_state <- full_join(dn_state, lq_state,
    by = "state"
  ) %>% 
    dplyr::mutate(
      distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)
    ) %>% 
    group_by(address.x) %>% 
    mutate(min_distance = min(distance))
  
  psych::describe(dn_lq_state$min_distance)
  ggplot(data = dn_lq_state, aes(x = min_distance)) +
    geom_density()
}
```

```{r Ex9-NC}
state_function("NC")
```

### Exercise 10

```{r Ex10-TX}
state_function("TX")
```

### Exercise 11

I chose New York for this exercise.
```{r Ex11-NY}
state_function("NY")
```

### Exercise 12

I think the joke is mostly true. It's easy to find a La Quinta close to a Denny's.

### Exercise 13

```{r Ex13}
# Create an empty data frame
df <- data.frame(
  state = character(),
  min_distance = numeric()
)

# Create a list of states
states <- list("NY", "NV", "NM", "NJ", "NH", "NE", "ND", "NC")

# Define another state function
state_function_2 <- function(state_abbr){
  
  dn_state <- dennys %>%
  filter(state == state_abbr) 

  lq_state <- laquinta %>%
  filter(state == state_abbr)
  
  dn_lq_state <- full_join(dn_state, lq_state,
    by = "state"
  ) %>% 
    dplyr::mutate(
      distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)
    ) %>% 
    group_by(address.x) %>% 
    mutate(min_distance = min(distance)) %>% 
    dplyr::select(state, min_distance)
  
  return(dn_lq_state)

}

# Loop over to calculate the min distances in the list of states
for (state in states){
  dn_lq_state <- state_function_2(state)
  df <- rbind(df, dn_lq_state)
}

ggplot(df, aes(x = min_distance, y = state)) + 
  geom_density_ridges(fill = "lightblue")
```

